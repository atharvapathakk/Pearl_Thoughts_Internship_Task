<!-- <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Portfolio Analysis</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <link rel="icon" type="image/png" href="static/Logo_White.png" />

  <style>
    :root {
      --primary-blue: #0055cc;
      --secondary-blue: #3385ff;
      --bg-dark: #0f0f0f;
      --card-bg: rgba(30, 30, 30, 0.95);
      --text-light: #e0e0e0;
      --accent-teal: #00c4b4;
      --gain-green: #10b981; /* Green for gains */
      --loss-red: #ef4444;   /* Red for losses */
    }

    body {
      background: linear-gradient(135deg, #0f0f0f, #1a1a1a);
      color: var(--text-light);
      font-family: 'Inter', sans-serif;
      margin: 0;
      min-height: 100vh;
      position: relative;
    }

    .navbar {
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(10px);
      padding: 1rem 2rem;
      border-bottom: 1px solid var(--primary-blue);
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .navbar-brand {
      font-weight: 700;
      font-size: 1.8rem;
      color: var(--primary-blue);
      transition: all 0.3s ease;
    }

    .back-btn {
      background: var(--primary-blue);
      border: none;
      padding: 0.5rem 1.5rem;
      border-radius: 8px;
      color: #fff;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .btn-custom { /* Styling for the Generate Analysis button */
        background-color: var(--accent-teal);
        border: none;
        color: #000;
        font-weight: 600;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        transition: all 0.3s ease;
    }
    .btn-custom:hover {
        background-color: #00e0cf;
        color: #000;
    }

    .analysis-container {
      max-width: 1100px; /* Slightly wider for professional look */
      margin: 60px auto;
      background: var(--card-bg);
      border-radius: 15px;
      padding: 2.5rem;
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
    }

    .analysis-container h2 {
      text-align: center;
      color: var(--secondary-blue);
      margin-bottom: 2rem;
      font-weight: 700;
    }

    /* === CHART LAYOUT ADJUSTMENTS FOR MEDIUM SIZE === */
    .chart-container {
      margin-top: 30px;
      background: rgba(255,255,255,0.05);
      border-radius: 10px;
      padding: 1rem;
      /* NEW: Added flex/centering to manage chart size/position */
      display: flex; /* Enable flex container */
      flex-direction: column; /* Stack children vertically */
      align-items: center; /* Center horizontally */
      justify-content: center; /* Center vertically if height is constrained */
      height: 400px; /* Set a fixed height for the container to limit vertical space */
    }
    
    /* NEW: Constrain the actual canvas element for 'medium' size, especially for square/circle charts */
    .chart-container canvas {
        max-width: 100%; /* Ensure it fits in its parent column */
        max-height: 350px; /* Constrain vertical size for a 'medium' feel */
        width: 100% !important; /* Override Chart.js default to enforce max-height */
        height: auto !important; /* Let height adjust while respecting max-height */
    }
    /* ============================================== */

    /* --- Styles for Results Block --- */

    .metric-card {
        background: rgba(45, 45, 45, 0.9);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 12px;
        padding: 1.2rem;
        text-align: center;
        margin-bottom: 1rem;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        transition: transform 0.2s;
        height: 100%;
    }

    .metric-card:hover {
        transform: translateY(-3px);
    }

    .metric-card h6 {
        font-size: 0.85rem;
        color: var(--secondary-blue);
        margin-bottom: 0.5rem;
        font-weight: 600;
    }

    .metric-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text-light);
        display: block;
    }

    .gain { color: var(--gain-green); }
    .loss { color: var(--loss-red); }
    .neutral { color: var(--accent-teal); }
    
    .deep-dive-header {
        color: var(--primary-blue);
        font-weight: 700;
        padding-bottom: 10px;
        border-bottom: 3px solid var(--accent-teal);
        margin-bottom: 30px;
        text-align: center;
    }

    /* --- Footer Styles (Keeping as requested) --- */
    .site-footer {
      background: rgba(5, 5, 5, 0.95);
      padding: 40px 0 20px;
      color: #e0e0e0;
      border-top: 1px solid var(--primary-blue);
      margin-top: 4rem;
    }

    .footer-links {
      list-style: none;
      padding-left: 0;
    }

    .social-icons {
      list-style: none;
      display: flex;
      gap: 10px;
    }
  </style>
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container-fluid d-flex justify-content-between align-items-center">
      <a class="navbar-brand" href="#"><i class="fas fa-chart-line"></i> Stock Insights</a>
      <a class="btn back-btn" href="{{ url_for('main.index') }}">
        <i class="fas fa-arrow-left"></i> Back
      </a>
    </div>
  </nav>

  <div class="analysis-container">
    <h2>Portfolio Analyzer</h2>

    <form method="POST">
      <div class="mb-4">
        <label for="user_prompt" class="form-label">Enter your portfolio data below.......</label>
        <textarea id="user_prompt" name="user_prompt" class="form-control" rows="6" placeholder="Start typing here.............">{{ user_prompt or '' }}</textarea>
      </div>
      <button type="submit" class="btn btn-custom">
        <i class="fas fa-bolt"></i> Generate Analysis
      </button>
    </form>
  </div>

  {% if invested_value %}

  <div class="analysis-container mt-4">
      <h3 class="deep-dive-header">Portfolio Deep Dive & Diagnostics</h3>

      <div class="row text-center">
          <div class="col-md-3 col-sm-6">
              <div class="metric-card">
                  <h6><i class="fas fa-hand-holding-usd"></i> Invested Capital</h6>
                  <span class="metric-value neutral">â‚¹{{ invested_value }}</span>
              </div>
          </div>

          <div class="col-md-3 col-sm-6">
              <div class="metric-card">
                  <h6><i class="fas fa-money-bill-wave"></i> Market Value</h6>
                  <span class="metric-value neutral">â‚¹{{ current_value }}</span>
              </div>
          </div>

          <div class="col-md-3 col-sm-6">
              <div class="metric-card">
                  <h6><i class="fas fa-percent"></i> Absolute Return</h6>
                  <span class="metric-value {{ 'gain' if overall_return_percent >= 0 else 'loss' }}">
                      {{ overall_return_percent }}%
                  </span>
              </div>
          </div>

          <div class="col-md-3 col-sm-6">
              <div class="metric-card">
                  <h6><i class="fas fa-balance-scale-right"></i> Net P&L (Value)</h6>
                  <span class="metric-value {{ 'gain' if total_gain_value >= 0 else 'loss' }}">
                      â‚¹{{ total_gain_value }}
                  </span>
              </div>
          </div>
      </div>

      <hr style="border-color: rgba(255, 255, 255, 0.1); margin-top: 2rem;">

      <div class="row">
          <div class="col-12">
              <div class="p-4 rounded" style="background: rgba(30, 30, 30, 0.9); border: 1px solid var(--secondary-blue);">
                  <h5 style="color: var(--secondary-blue); font-weight: 600;"><i class="fas fa-file-invoice"></i> Executive Summary</h5>
                  <p class="mt-3">{{ summary }}</p>
              </div>
          </div>
      </div>

      <hr style="border-color: rgba(255, 255, 255, 0.1); margin-top: 2rem;">

      <h3 class="text-center mt-5 mb-4" style="color: var(--secondary-blue); font-weight: 600;">ðŸ“Š Portfolio Visualizations</h3>

      <div class="row">
          <div class="col-lg-6 col-md-12 mb-4">
              <div class="chart-container">
                  <h5 class="text-center mb-3 text-light"><i class="fas fa-chart-bar"></i> Value Comparison</h5>
                  <canvas id="barChart"></canvas>
              </div>
          </div>

          <div class="col-lg-6 col-md-12 mb-4">
              <div class="chart-container">
                  <h5 class="text-center mb-3 text-light"><i class="fas fa-ring"></i> Top Holdings Weight</h5>
                  <canvas id="donutChart"></canvas>
              </div>
          </div>
      </div>
      
      <div class="row">
          <div class="col-12 mb-4">
              <div class="chart-container">
                  <h5 class="text-center mb-3 text-light"><i class="fas fa-chart-pie"></i> Sector Allocation</h5>
                  <canvas id="pieChart"></canvas>
              </div>
          </div>
      </div>
  </div>

  <div class="analysis-container mt-4">


        <span class="metric-value {{ 'gain' if total_gain_value >= 0 else 'loss' }}">
                     percent in it : - {{ percentNeed_in_IT }}
                     percent in fiannce : - {{ percentNeed_in_finance }}
                     percent in energy : - {{ percentNeed_in_energy }}
                     percent in Consumer discreationary : - {{ percentNeed_in_CD }}
                     percent in consume staples : - {{ percentNeed_in_CS }}
                     percent in healthcare : - {{ percentNeed_in_heathcare }}
                     percent in industrials : - {{ percentNeed_in_industrials }}
                     percent in materials : - {{ percentNeed_in_materials }}
                     percent in commuication services : - {{ percentNeed_in_communication_services }}
                     percent in utilities : - {{ percentNeed_in_utilities }}
                     percent in rea_estate : - {{ percentNeed_in_real_estate }}
                     percent in real other : - {{ percentNeed_in_real_other }}
                  </span>


  </div>

  {% endif %}

  <footer class="site-footer">
    <div class="container">
      <div class="row">
        <div class="col-md-4 col-sm-6 footer-col">
          <h6>Stock Insights</h6>
          <p>Stock Insights provides advanced tools for stock analysis.<br><strong>Investing is risky. Consult a financial advisor.</strong></p>
        </div>
        <div class="col-md-4 col-sm-6 footer-col">
          <h6>Quick Links</h6>
          <ul class="footer-links">
            <li><a href="About_us.html">About Us</a></li>
            <li><a href="#">Contact Us</a></li>
          </ul>
        </div>
        <div class="col-md-4 col-sm-6 footer-col">
          <h6>Legal</h6>
          <ul class="footer-links">
            <li><a href="Terms_of_service.html">Terms of Service</a></li>
            <li><a href="Privacy_policy.html">Privacy Policy</a></li>
          </ul>
        </div>
      </div>
      <hr />
      <div class="row">
        <div class="col-md-8 col-sm-6">
          <p class="copyright-text">
            &copy; <span id="currentYear"></span> Stock Insights App. All Rights Reserved.
          </p>
        </div>
        <div class="col-md-4 col-sm-6">
          <ul class="social-icons">
            <li><a class="linkedin" href="https://www.linkedin.com/company/stock-insight" target="_blank"><i class="fab fa-linkedin"></i></a></li>
          </ul>
        </div>
      </div>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    document.getElementById("currentYear").textContent = new Date().getFullYear();

    {% if invested_value %}
    
    // BAR CHART: Investment vs Current
    const barCtx = document.getElementById('barChart').getContext('2d');
    new Chart(barCtx, {
      type: 'bar',
      data: {
        labels: ['Invested Value', 'Current Value'],
        datasets: [{
          label: 'Portfolio Value (â‚¹)',
          data: [{{ invested_value }}, {{ current_value }}],
          backgroundColor: ['#00c4b4', '#3385ff']
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: {
          y: { 
            beginAtZero: true,
            ticks: { color: 'rgba(224, 224, 224, 0.7)' },
            grid: { color: 'rgba(255, 255, 255, 0.1)' }
          },
          x: { 
            ticks: { color: 'rgba(224, 224, 224, 0.7)' },
            grid: { display: false }
          }
        }
      }
    });

    // PIE CHART: Sector Allocation (Now full width)
    const pieCtx = document.getElementById('pieChart').getContext('2d');
    new Chart(pieCtx, {
      type: 'pie',
      data: {
        labels: ['IT','Financials','Energy','Consumer Discretionary','Consumer Staples','Health Care','Industrials','Materials','Communication Services','Utilities','Real Estate','Other'],
        datasets: [{
          data: [
            {{ sector_allocation_percent_IT }},
            {{ sector_allocation_percent_Financials }},
            {{ sector_allocation_percent_Energy }},
            {{ sector_allocation_percent_Consumer_Discretionary }},
            {{ sector_allocation_percent_Consumer_Staples }},
            {{ sector_allocation_percent_Health_Care }},
            {{ sector_allocation_percent_Industrials }},
            {{ sector_allocation_percent_Materials }},
            {{ sector_allocation_percent_Communication_Services }},
            {{ sector_allocation_percent_Utilities }},
            {{ sector_allocation_percent_Real_Estate }},
            {{ sector_allocation_percent_Real_Other }}
          ],
          backgroundColor: [
            '#007bff','#28a745','#ffc107','#dc3545','#17a2b8','#6f42c1','#20c997','#fd7e14','#e83e8c','#6610f2','#adb5bd','#0dcaf0'
          ]
        }]
      },
      options: {
        responsive: true,
        plugins: { 
            legend: { 
                position: 'bottom',
                labels: { color: 'rgba(224, 224, 224, 0.9)' }
            } 
        }
      }
    });

    // DONUT CHART: Top Holdings Allocation 
    const donutCtx = document.getElementById('donutChart').getContext('2d');
    new Chart(donutCtx, {
      type: 'doughnut',
      data: {
        // You MUST replace this static data with actual Flask variables: {{ top_holding_names }} and {{ top_holding_weights }}
        labels: ['HDFC Bank', 'TCS', 'Infosys', 'Reliance Industries', 'Others'],
        datasets: [{
          data: [30, 25, 20, 15, 10], // Example data
          // data: {{ top_holding_weights }}, // Use this in your Flask app
          backgroundColor: [
            '#3385ff', // Secondary Blue
            '#00c4b4', // Accent Teal
            '#ffc107', // Yellow
            '#dc3545', // Red
            '#6c757d'  // Gray
          ]
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { 
            position: 'bottom',
            labels: { color: 'rgba(224, 224, 224, 0.9)' }
          },
          title: { display: false }
        }
      }
    });
    {% endif %}
  </script>
</body>
</html> -->














<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Portfolio Analysis</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <link rel="icon" type="image/png" href="static/Logo_White.png" />

  <style>
    :root {
      --primary-blue: #0055cc;
      --secondary-blue: #3385ff;
      --bg-dark: #0f0f0f;
      --card-bg: rgba(30, 30, 30, 0.95);
      --text-light: #e0e0e0;
      --accent-teal: #00c4b4;
      --gain-green: #10b981;
      --loss-red: #ef4444;
    }

    body {
      background: linear-gradient(135deg, #0f0f0f, #1a1a1a);
      color: var(--text-light);
      font-family: 'Inter', sans-serif;
      margin: 0;
      min-height: 100vh;
      position: relative;
    }

    .navbar {
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(10px);
      padding: 1rem 2rem;
      border-bottom: 1px solid var(--primary-blue);
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .navbar-brand {
      font-weight: 700;
      font-size: 1.8rem;
      color: var(--primary-blue);
      transition: all 0.3s ease;
    }

    .back-btn {
      background: var(--primary-blue);
      border: none;
      padding: 0.5rem 1.5rem;
      border-radius: 8px;
      color: #fff;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .btn-custom {
      background-color: var(--accent-teal);
      border: none;
      color: #000;
      font-weight: 600;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .btn-custom:hover {
      background-color: #00e0cf;
      color: #000;
    }

    .analysis-container {
      max-width: 1100px;
      margin: 60px auto;
      background: var(--card-bg);
      border-radius: 15px;
      padding: 2.5rem;
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
    }

    .analysis-container h2 {
      text-align: center;
      color: var(--secondary-blue);
      margin-bottom: 2rem;
      font-weight: 700;
    }

    .chart-container {
      margin-top: 30px;
      background: rgba(255,255,255,0.05);
      border-radius: 10px;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 400px;
    }

    .chart-container canvas {
        max-width: 100%;
        max-height: 350px;
        width: 100% !important;
        height: auto !important;
    }

    .metric-card {
        background: rgba(45, 45, 45, 0.9);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 12px;
        padding: 1.2rem;
        text-align: center;
        margin-bottom: 1rem;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        transition: transform 0.2s;
        height: 100%;
    }

    .metric-card:hover {
        transform: translateY(-3px);
    }

    .metric-card h6 {
        font-size: 0.85rem;
        color: var(--secondary-blue);
        margin-bottom: 0.5rem;
        font-weight: 600;
    }

    .metric-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text-light);
        display: block;
    }

    .gain { color: var(--gain-green); }
    .loss { color: var(--loss-red); }
    .neutral { color: var(--accent-teal); }

    .deep-dive-header {
        color: var(--primary-blue);
        font-weight: 700;
        padding-bottom: 10px;
        border-bottom: 3px solid var(--accent-teal);
        margin-bottom: 30px;
        text-align: center;
    }

    /* === SECTOR ADJUSTMENT TABLE === */
    .table {
      background-color: rgba(20, 20, 20, 0.85);
      border-radius: 10px;
      overflow: hidden;
      border-collapse: separate !important;
      border-spacing: 0;
    }

    .table th {
      background-color: rgba(0, 85, 204, 0.3);
      color: var(--accent-teal);
      font-weight: 700;
      text-transform: uppercase;
      font-size: 0.9rem;
    }

    .table td {
      color: var(--text-light);
      font-size: 0.95rem;
      vertical-align: middle;
    }

    .table tbody tr:hover {
      background-color: rgba(0, 196, 180, 0.08);
      transition: background 0.3s ease;
    }

    .text-success {
      color: #10b981 !important;
    }

    .text-danger {
      color: #ef4444 !important;
    }

    .site-footer {
      background: rgba(5, 5, 5, 0.95);
      padding: 40px 0 20px;
      color: #e0e0e0;
      border-top: 1px solid var(--primary-blue);
      margin-top: 4rem;
    }

    .footer-links {
      list-style: none;
      padding-left: 0;
    }

    .social-icons {
      list-style: none;
      display: flex;
      gap: 10px;
    }
  </style>
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container-fluid d-flex justify-content-between align-items-center">
      <a class="navbar-brand" href="#"><i class="fas fa-chart-line"></i> Stock Insights</a>
      <a class="btn back-btn" href="{{ url_for('main.index') }}">
        <i class="fas fa-arrow-left"></i> Back
      </a>
    </div>
  </nav>

  <div class="analysis-container">
    <h2>Portfolio Analyzer</h2>

    <form method="POST">
      <div class="mb-4">
        <label for="user_prompt" class="form-label">Enter your portfolio data below.......</label>
        <textarea id="user_prompt" name="user_prompt" class="form-control" rows="6" placeholder="Start typing here.............">{{ user_prompt or '' }}</textarea>
      </div>
      <button type="submit" class="btn btn-custom">
        <i class="fas fa-bolt"></i> Generate Analysis
      </button>
    </form>
  </div>

  {% if invested_value %}

  <div class="analysis-container mt-4">
      <h3 class="deep-dive-header">Portfolio Deep Dive & Diagnostics</h3>

      <div class="row text-center">
          <div class="col-md-3 col-sm-6">
              <div class="metric-card">
                  <h6><i class="fas fa-hand-holding-usd"></i> Invested Capital</h6>
                  <span class="metric-value neutral">â‚¹{{ invested_value }}</span>
              </div>
          </div>

          <div class="col-md-3 col-sm-6">
              <div class="metric-card">
                  <h6><i class="fas fa-money-bill-wave"></i> Market Value</h6>
                  <span class="metric-value neutral">â‚¹{{ current_value }}</span>
              </div>
          </div>

          <div class="col-md-3 col-sm-6">
              <div class="metric-card">
                  <h6><i class="fas fa-percent"></i> Absolute Return</h6>
                  <span class="metric-value {{ 'gain' if overall_return_percent >= 0 else 'loss' }}">
                      {{ overall_return_percent }}%
                  </span>
              </div>
          </div>

          <div class="col-md-3 col-sm-6">
              <div class="metric-card">
                  <h6><i class="fas fa-balance-scale-right"></i> Net P&L (Value)</h6>
                  <span class="metric-value {{ 'gain' if total_gain_value >= 0 else 'loss' }}">
                      â‚¹{{ total_gain_value }}
                  </span>
              </div>
          </div>
      </div>

      <hr style="border-color: rgba(255, 255, 255, 0.1); margin-top: 2rem;">

      <div class="row">
          <div class="col-12">
              <div class="p-4 rounded" style="background: rgba(30, 30, 30, 0.9); border: 1px solid var(--secondary-blue);">
                  <h5 style="color: var(--secondary-blue); font-weight: 600;"><i class="fas fa-file-invoice"></i> Executive Summary</h5>
                  <p class="mt-3">{{ summary }}</p>
              </div>
          </div>
      </div>

      <hr style="border-color: rgba(255, 255, 255, 0.1); margin-top: 2rem;">
      {{top_holdings}}

      <h3 class="text-center mt-5 mb-4" style="color: var(--secondary-blue); font-weight: 600;">ðŸ“Š Portfolio Visualizations</h3>

      <div class="row">
          <div class="col-lg-6 col-md-12 mb-4">
              <div class="chart-container">
                  <h5 class="text-center mb-3 text-light"><i class="fas fa-chart-bar"></i> Value Comparison</h5>
                  <canvas id="barChart"></canvas>
              </div>
          </div>

          <div class="col-lg-6 col-md-12 mb-4">
              <div class="chart-container">
                  <h5 class="text-center mb-3 text-light"><i class="fas fa-ring"></i> Top Holdings Weight</h5>
                  <canvas id="donutChart"></canvas>

                
              </div>
          </div>
      </div>

      <div class="row">
          <div class="col-12 mb-4">
              <div class="chart-container">
                  <h5 class="text-center mb-3 text-light"><i class="fas fa-chart-pie"></i> Sector Allocation</h5>
                  <canvas id="pieChart"></canvas>
              </div>
          </div>
      </div>
  </div>

  <!-- === SECTOR TABLE START === -->
  <div class="analysis-container mt-4">
    <h3 class="deep-dive-header">Sector Adjustment Recommendations</h3>
    <div class="table-responsive">
      <table class="table table-dark table-striped align-middle text-center">
        <thead>
          <tr style="color: var(--accent-teal);">
            <th>Sector</th>
            <th>Required Adjustment</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          {% set sectors = {
            "Information Technology": percentNeed_in_IT,
            "Financials": percentNeed_in_finance,
            "Energy": percentNeed_in_energy,
            "Consumer Discretionary": percentNeed_in_CD,
            "Consumer Staples": percentNeed_in_CS,
            "Healthcare": percentNeed_in_healthcare,
            "Industrials": percentNeed_in_industrials,
            "Materials": percentNeed_in_materials,
            "Communication Services": percentNeed_in_communication_services,
            "Utilities": percentNeed_in_utilities,
            "Real Estate": percentNeed_in_real_estate,
            "Other": percentNeed_in_real_other
          } %}

          {% for sector, percent in sectors.items() %}
          <tr>
            <td>{{ sector }}</td>
            <td>
              {% if percent >= 0 %}
                <span class="text-success fw-bold">+{{ "%.2f"|format(percent) }}%</span>
              {% else %}
                <span class="text-danger fw-bold">{{ "%.2f"|format(percent) }}%</span>
              {% endif %}
            </td>
            <td>
              {% if percent > 0 %}
                <i class="fas fa-arrow-up text-success"></i> Increase
              {% elif percent < 0 %}
                <i class="fas fa-arrow-down text-danger"></i> Decrease
              {% else %}
                <i class="fas fa-minus text-secondary"></i> Neutral
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  <!-- === SECTOR TABLE END === -->

  {% endif %}

  <footer class="site-footer">
    <div class="container">
      <div class="row">
        <div class="col-md-4 col-sm-6 footer-col">
          <h6>Stock Insights</h6>
          <p>Stock Insights provides advanced tools for stock analysis.<br><strong>Investing is risky. Consult a financial advisor.</strong></p>
        </div>
        <div class="col-md-4 col-sm-6 footer-col">
          <h6>Quick Links</h6>
          <ul class="footer-links">
            <li><a href="About_us.html">About Us</a></li>
            <li><a href="#">Contact Us</a></li>
          </ul>
        </div>
        <div class="col-md-4 col-sm-6 footer-col">
          <h6>Legal</h6>
          <ul class="footer-links">
            <li><a href="Terms_of_service.html">Terms of Service</a></li>
            <li><a href="Privacy_policy.html">Privacy Policy</a></li>
          </ul>
        </div>
      </div>
      <hr />
      <div class="row">
        <div class="col-md-8 col-sm-6">
          <p class="copyright-text">
            &copy; <span id="currentYear"></span> Stock Insights App. All Rights Reserved.
          </p>
        </div>
        <div class="col-md-4 col-sm-6">
          <ul class="social-icons">
            <li><a class="linkedin" href="https://www.linkedin.com/company/stock-insight" target="_blank"><i class="fab fa-linkedin"></i></a></li>
          </ul>
        </div>
      </div>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  document.getElementById("currentYear").textContent = new Date().getFullYear();

  {% if invested_value %}
  // === Bar Chart ===
  const barCtx = document.getElementById('barChart').getContext('2d');
  new Chart(barCtx, {
    type: 'bar',
    data: {
      labels: ['Invested Value', 'Current Value'],
      datasets: [{
        label: 'Portfolio Value (â‚¹)',
        data: [{{ invested_value }}, {{ current_value }}],
        backgroundColor: ['#00c4b4', '#3385ff']
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: false } },
      scales: {
        y: { 
          beginAtZero: true,
          ticks: { color: 'rgba(224, 224, 224, 0.7)' },
          grid: { color: 'rgba(255, 255, 255, 0.1)' }
        },
        x: { 
          ticks: { color: 'rgba(224, 224, 224, 0.7)' },
          grid: { display: false }
        }
      }
    }
  });

  // === Pie Chart ===
  const pieCtx = document.getElementById('pieChart').getContext('2d');
  new Chart(pieCtx, {
    type: 'pie',
    data: {
      labels: ['IT','Financials','Energy','Consumer Discretionary','Consumer Staples','Health Care','Industrials','Materials','Communication Services','Utilities','Real Estate','Other'],
      datasets: [{
        data: [
          {{ sector_allocation_percent_IT }},
          {{ sector_allocation_percent_Financials }},
          {{ sector_allocation_percent_Energy }},
          {{ sector_allocation_percent_Consumer_Discretionary }},
          {{ sector_allocation_percent_Consumer_Staples }},
          {{ sector_allocation_percent_Health_Care }},
          {{ sector_allocation_percent_Industrials }},
          {{ sector_allocation_percent_Materials }},
          {{ sector_allocation_percent_Communication_Services }},
          {{ sector_allocation_percent_Utilities }},
          {{ sector_allocation_percent_Real_Estate }},
          {{ sector_allocation_percent_Real_Other }}
        ],
        backgroundColor: [
          '#007bff','#28a745','#ffc107','#dc3545','#17a2b8','#6f42c1','#20c997','#fd7e14','#e83e8c','#6610f2','#adb5bd','#0dcaf0'
        ]
      }]
    },
    options: {
      responsive: true,
      plugins: { 
        legend: { 
          position: 'bottom',
          labels: { color: 'rgba(224, 224, 224, 0.9)' }
        } 
      }
    }
  });

  // === Doughnut Chart (Top Holdings) ===
  const donutCtx = document.getElementById('donutChart').getContext('2d');
  const topHoldingsData = {{ top_holdings | tojson }};
  const topHoldingsLabels = topHoldingsData.map(item => item.symbol);
  const topHoldingsWeights = topHoldingsData.map(item => item.weight_percent);

  new Chart(donutCtx, {
    type: 'doughnut',
    data: {
      labels: topHoldingsLabels,
      datasets: [{
        data: topHoldingsWeights,
        backgroundColor: [
          '#3385ff', '#00c4b4', '#ffc107', '#dc3545', '#6c757d',
          '#20c997', '#6f42c1', '#fd7e14', '#e83e8c', '#6610f2'
        ]
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          position: 'bottom',
          labels: { color: 'rgba(224, 224, 224, 0.9)' }
        }
      }
    }
  });
  {% endif %}
</script>
</body>
</html>





